# åŸºäºMinIOã€DuckDBå’ŒRedisçš„åˆ†å¸ƒå¼OLAPç³»ç»Ÿ

## 1. ç³»ç»Ÿæ¦‚è¿°

æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªæè‡´è½»é‡åŒ–ã€é«˜æ€§èƒ½ã€å¯æ°´å¹³æ‰©å±•çš„åˆ†å¸ƒå¼å¯¹è±¡å­˜å‚¨ä¸OLAPæŸ¥è¯¢åˆ†æç³»ç»Ÿã€‚ç³»ç»Ÿä»¥MinIOä½œä¸ºå…¶åˆ†å¸ƒå¼å­˜å‚¨åº•åº§ï¼Œä¿è¯æ•°æ®çš„å¯é æ€§å’Œæ‰©å±•æ€§ï¼›åˆ©ç”¨DuckDBä½œä¸ºé«˜æ€§èƒ½çš„OLAPæŸ¥è¯¢å¼•æ“ï¼Œå®ç°å¯¹TBçº§æ•°æ®çš„å¿«é€Ÿåˆ†æï¼›å¹¶é‡‡ç”¨Redisä½œä¸ºæ ¸å¿ƒå…ƒæ•°æ®ä¸­å¿ƒï¼Œè´Ÿè´£æœåŠ¡å‘ç°ã€èŠ‚ç‚¹ç®¡ç†ä»¥åŠæ•°æ®åˆ†ç‰‡çš„ç´¢å¼•ã€‚

è¯¥ç³»ç»Ÿçš„æ ¸å¿ƒç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªéƒ¨ç½²ç®€å•ï¼ˆæ”¯æŒå•æœºå•èŠ‚ç‚¹å’Œåˆ†å¸ƒå¼å¤šèŠ‚ç‚¹ï¼‰ã€èµ„æºå ç”¨å°‘ã€æœåŠ¡å¥å£®ã€å…·å¤‡é«˜å¯ç”¨å’Œæ•°æ®å¤‡ä»½èƒ½åŠ›ã€å¹¶èƒ½é€šè¿‡å¢åŠ èŠ‚ç‚¹çº¿æ€§æå‡å¤„ç†èƒ½åŠ›çš„ç°ä»£åŒ–æ•°æ®åˆ†æå¹³å°ã€‚

**ğŸ¯ å•èŠ‚ç‚¹æ¨¡å¼æ”¯æŒ**ï¼šç³»ç»Ÿæ”¯æŒé€šè¿‡é…ç½®Rediså¼€å…³å®ç°å•èŠ‚ç‚¹æ¨¡å¼ï¼Œæ— éœ€Redisä¾èµ–å³å¯è¿è¡Œï¼Œé€‚åˆé¡¹ç›®åˆæœŸæˆ–èµ„æºå—é™ç¯å¢ƒã€‚å•èŠ‚ç‚¹æ¨¡å¼ä¸‹ç³»ç»Ÿè‡ªåŠ¨è·³è¿‡æœåŠ¡æ³¨å†Œã€ä½¿ç”¨æœ¬åœ°èŠ‚ç‚¹è·¯ç”±ã€ç›´æ¥è®¿é—®MinIOå­˜å‚¨ï¼Œå®Œå…¨å‘åå…¼å®¹åˆ†å¸ƒå¼æ¨¡å¼ã€‚

## 2. æ ¸å¿ƒè®¾è®¡ç†å¿µ

*   **å­˜ç®—åˆ†ç¦»**: ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯å­˜å‚¨ä¸è®¡ç®—çš„åˆ†ç¦»ã€‚MinIOè´Ÿè´£"å­˜å‚¨"ï¼Œæä¾›ä¸€ä¸ªæ— é™æ‰©å±•çš„S3å…¼å®¹å¯¹è±¡å­˜å‚¨æ± ã€‚DuckDBè´Ÿè´£"è®¡ç®—"ï¼Œå®ƒä¸æŒä¹…åŒ–å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯åœ¨æŸ¥è¯¢æ—¶ç›´æ¥ä»MinIOä¸­æµå¼è¯»å–æ•°æ®è¿›è¡Œåˆ†æã€‚è¿™ç§æ¶æ„å¸¦æ¥äº†æè‡´çš„å¼¹æ€§å’Œæ‰©å±•æ€§ã€‚
*   **è½»é‡åŒ–ä¸é«˜æ€§èƒ½**: æ‰€æœ‰ç»„ä»¶ï¼ˆMinIO, DuckDB, Redisï¼‰éƒ½æ˜¯ä»¥é«˜æ€§èƒ½å’Œä½èµ„æºå ç”¨è‘—ç§°çš„ã€‚DuckDBå°¤å…¶æ“…é•¿ç›´æ¥æŸ¥è¯¢Parquetç­‰åˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œæ— éœ€æ•°æ®å¯¼å…¥ï¼Œæå¤§åœ°æå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚ä¸»è¦æ»¡è¶³èµ„æºå—é™åœºæ™¯ä¸‹çš„OLAPåˆ†æåœºæ™¯ã€‚
*   **å…ƒæ•°æ®é©±åŠ¨**: ç³»ç»Ÿçš„åˆ†å¸ƒå¼åè°ƒèƒ½åŠ›å®Œå…¨ç”±Redisä¸­çš„å…ƒæ•°æ®é©±åŠ¨ã€‚æ— è®ºæ˜¯æ–°èŠ‚ç‚¹åŠ å…¥ã€æ•°æ®åˆ†ç‰‡ä½ç½®ï¼Œè¿˜æ˜¯æŸ¥è¯¢è·¯ç”±ï¼Œéƒ½é€šè¿‡æŸ¥è¯¢Rediså®Œæˆï¼Œä½¿å¾—æ•´ä¸ªç³»ç»Ÿé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç®¡ç†ã€‚
*   **è‡ªåŠ¨åŒ–ä¸è‡ªæ„ˆ**: é€šè¿‡æœåŠ¡æ³¨å†Œä¸å¿ƒè·³æœºåˆ¶ï¼Œç³»ç»Ÿèƒ½è‡ªåŠ¨æ„ŸçŸ¥èŠ‚ç‚¹çš„åŠ å…¥ä¸ç¦»å¼€ã€‚é€šè¿‡ä¸€è‡´æ€§å“ˆå¸Œè¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼ŒèŠ‚ç‚¹æ‰©å±•åæ–°æ•°æ®èƒ½è‡ªåŠ¨è·¯ç”±åˆ°æ–°èŠ‚ç‚¹ï¼Œå®ç°è‡ªåŠ¨åŒ–çš„æ°´å¹³æ‰©å±•ã€‚
*   **çµæ´»éƒ¨ç½²æ¨¡å¼**: ç³»ç»Ÿæ”¯æŒä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š**å•èŠ‚ç‚¹æ¨¡å¼**ï¼ˆRediså…³é—­ï¼‰å’Œ**åˆ†å¸ƒå¼æ¨¡å¼**ï¼ˆRediså¼€å¯ï¼‰ã€‚å•èŠ‚ç‚¹æ¨¡å¼é€‚åˆå¼€å‘æµ‹è¯•å’Œèµ„æºå—é™ç¯å¢ƒï¼Œåˆ†å¸ƒå¼æ¨¡å¼é€‚åˆç”Ÿäº§ç¯å¢ƒå’Œé«˜å¯ç”¨åœºæ™¯ã€‚ä¸¤ç§æ¨¡å¼å¯ä»¥æ— ç¼åˆ‡æ¢ï¼Œå®Œå…¨å‘åå…¼å®¹ã€‚
*   **æ•°æ®å®‰å…¨ä¸å¤‡ä»½**: ç³»ç»Ÿå°†æ¯ä¸ªå­˜å‚¨å®ä¾‹è§†ä¸ºç‹¬ç«‹èŠ‚ç‚¹ã€‚ä¸ºäº†é˜²æ­¢å•ç‚¹æ•…éšœï¼Œå†…ç½®äº†çµæ´»çš„æ•°æ®å¤‡ä»½æœºåˆ¶ï¼Œæ”¯æŒå°†æ•°æ®è‡ªåŠ¨æˆ–æ‰‹åŠ¨å¤‡ä»½åˆ°ç‹¬ç«‹çš„å¤‡ä»½å­˜å‚¨ä¸­ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ã€‚
*   **è¡¨çº§æ•°æ®ç®¡ç†**: å¼•å…¥è¡¨ï¼ˆTableï¼‰æ¦‚å¿µï¼Œå°†æ•°æ®æŒ‰ä¸šåŠ¡ç±»å‹è¿›è¡Œé€»è¾‘åˆ†ç¦»ï¼Œæä¾›è¡¨çº§çš„ç®¡ç†ã€é…ç½®å’Œæƒé™æ§åˆ¶èƒ½åŠ›ï¼Œå®ç°æ›´ç²¾ç»†åŒ–çš„æ•°æ®ç»„ç»‡å’Œæ²»ç†ã€‚

## 3. æ¶æ„è®¾è®¡

### 3.1. æ•´ä½“æ¶æ„å›¾

#### 3.1.1. åˆ†å¸ƒå¼æ¨¡å¼æ¶æ„ï¼ˆRediså¯ç”¨ï¼‰

```
+----------------+      +----------------+
|   gRPC Client  |      |  RESTful Client|
+----------------+      +----------------+
        |                      |
        v                      v
+------------------------------------------+
|     API Gateway / Query Node (Go)       |  <-- (ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥æ‰®æ¼”æ­¤è§’è‰²)
|                                          |
|  - Request Parsing & Validation          |
|  - Query Coordination                    |
|  - Result Aggregation                    |
|  - Metadata Manager                      |
|    â”œâ”€ Version Management                 |
|    â”œâ”€ Backup/Recovery Control            |
|    â””â”€ Distributed Lock Management        |
+------------------------------------------+
      ^   |                    ^   |
      |   |                    |   | 
      |   v                    |   v
+------------------------------------------+
|        Connection Pool Manager           |
|                                          |
|  Redis Pool      |    MinIO Pool         |
|  â”œâ”€ Standalone   |    â”œâ”€ Primary Pool    |
|  â”œâ”€ Sentinel     |    â”œâ”€ Backup Pool     |
|  â”œâ”€ Cluster      |    â”œâ”€ Health Check    |
|  â””â”€ Health Check |    â””â”€ Auto Failover   |
+------------------------------------------+
      ^   |                    ^   |
      |   v                    |   v  (Service Discovery & Query Planning)
+----------------+      +---------------------------------+
| Redis          |      | Worker Nodes (Go Service)       |
| ---------------|      |---------------------------------|
| - Service Reg. |<-----| - Heartbeat & Registration      |
| - Data Index   |----->| - DuckDB Instance (embedded)    |
| - Hash Ring    |      | - Data Ingestion & Buffering    |
| - Table Meta   |      | - Parquet File Generation       |
| - Metadata Ver |      | - Read/Write to MinIO           |
| - Backup Index |      | - Table-level Processing        |
+----------------+      | - Connection Pool Client        |
                        +---------------------------------+
                                 ^         |
                                 |         | (S3 API via Pool)
                                 v         v
                       +-------------------------+
                       |   MinIO Cluster         |
                       | (Distributed Object     |
                       |      Storage)           |
                       | â”œâ”€ Primary Storage      |
                       | â”œâ”€ Backup Storage       |
                       | â””â”€ TABLE/ID/YYYY-MM-DD/ |
                       +-------------------------+
```

#### 3.1.2. å•èŠ‚ç‚¹æ¨¡å¼æ¶æ„ï¼ˆRediså…³é—­ï¼‰

```
+----------------+      +----------------+
|   gRPC Client  |      |  RESTful Client|
+----------------+      +----------------+
        |                      |
        v                      v
+------------------------------------------+
|        Single Node (Go Service)          |
|                                          |
|  - Request Parsing & Validation          |
|  - Local Query Coordination              |
|  - Direct Result Processing              |
|  - Local Metadata Management             |
|    â”œâ”€ Local Table Management             |
|    â”œâ”€ Local Backup Control               |
|    â””â”€ Direct MinIO Access                |
|                                          |
|  - DuckDB Instance (embedded)            |
|  - Data Ingestion & Buffering            |
|  - Parquet File Generation               |
|  - Table-level Processing                |
+------------------------------------------+
                                 |
                                 | (Direct S3 API)
                                 v
                       +-------------------------+
                       |   MinIO Server          |
                       | (Single Object Storage) |
                       | â”œâ”€ Primary Storage      |
                       | â”œâ”€ Backup Storage       |
                       | â””â”€ TABLE/ID/YYYY-MM-DD/ |
                       +-------------------------+
```

**å•èŠ‚ç‚¹æ¨¡å¼ç‰¹ç‚¹ï¼š**
- âœ… **æ— éœ€Redisä¾èµ–**ï¼šé€šè¿‡é…ç½®`redis.enabled: false`å³å¯å¯ç”¨
- âœ… **æœ¬åœ°èŠ‚ç‚¹è·¯ç”±**ï¼šæ‰€æœ‰æ“ä½œç›´æ¥åœ¨æœ¬èŠ‚ç‚¹å¤„ç†
- âœ… **ç›´æ¥MinIOè®¿é—®**ï¼šé€šè¿‡MinIOå¯¹è±¡è·¯å¾„ç›´æ¥è·å–æ•°æ®ç´¢å¼•
- âœ… **ç®€åŒ–éƒ¨ç½²**ï¼šåªéœ€MinIO + MinIODBæœåŠ¡å³å¯è¿è¡Œ
- âœ… **å®Œå…¨å…¼å®¹**ï¼šAPIæ¥å£ä¸åˆ†å¸ƒå¼æ¨¡å¼å®Œå…¨ä¸€è‡´

### 3.2. æ¨¡å—æ‹†è§£

#### a. æ•°æ®æ¥å…¥ä¸æŸ¥è¯¢åè°ƒå±‚ (Go Service)

è¿™æ˜¯ç³»ç»Ÿçš„å…¥å£ã€‚å®ƒå¯ä»¥æ˜¯é›†ç¾¤ä¸­çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚
*   **APIæ¥å£**: æä¾›Restfulå’ŒgRPCä¸¤ç§æ ‡å‡†æ¥å£ï¼Œæ¥æ”¶æ•°æ®å†™å…¥å’ŒæŸ¥è¯¢è¯·æ±‚ã€‚
*   **å…ƒæ•°æ®ç®¡ç†å™¨ (Metadata Manager)**:
    1.  **ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ**: ç»´æŠ¤ç³»ç»Ÿå…ƒæ•°æ®çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œæ”¯æŒç‰ˆæœ¬æ¯”è¾ƒå’Œå†²çªæ£€æµ‹ã€‚
    2.  **å¤‡ä»½æ§åˆ¶å™¨**: åè°ƒå…ƒæ•°æ®çš„è‡ªåŠ¨å’Œæ‰‹åŠ¨å¤‡ä»½æ“ä½œã€‚
    3.  **æ¢å¤ç®¡ç†å™¨**: å¤„ç†å…ƒæ•°æ®æ¢å¤è¯·æ±‚ï¼Œæ”¯æŒå®Œæ•´æ¢å¤å’Œå¢é‡æ¢å¤ã€‚
    4.  **åˆ†å¸ƒå¼é”ç®¡ç†**: ä½¿ç”¨Redisåˆ†å¸ƒå¼é”é˜²æ­¢å¤šèŠ‚ç‚¹å¹¶å‘æ“ä½œå†²çªã€‚
    5.  **ä¸€è‡´æ€§æ£€æŸ¥**: å®šæœŸéªŒè¯å¤šèŠ‚ç‚¹é—´å…ƒæ•°æ®çš„ä¸€è‡´æ€§ã€‚
*   **è¡¨ç®¡ç†å™¨ (Table Manager)**:
    1.  è´Ÿè´£è¡¨çš„åˆ›å»ºã€åˆ é™¤ã€é…ç½®ç®¡ç†ç­‰æ“ä½œã€‚
    2.  ç»´æŠ¤è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬é…ç½®ã€ç»Ÿè®¡ä¿¡æ¯ã€æƒé™ç­‰ã€‚
    3.  æä¾›è¡¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬æ•°æ®æ¸…ç†ã€å¤‡ä»½ç­‰ã€‚
*   **æŸ¥è¯¢åè°ƒå™¨ (Query Coordinator)**:
    1.  æ¥æ”¶åˆ°æŸ¥è¯¢è¯·æ±‚åï¼Œè§£æSQLä¸­çš„è¡¨åï¼ŒéªŒè¯è¡¨çš„å­˜åœ¨æ€§å’Œè®¿é—®æƒé™ã€‚
    2.  æ ¹æ®æŸ¥è¯¢æ¡ä»¶ï¼ˆå¦‚è¡¨åã€IDèŒƒå›´ã€æ—¶é—´èŒƒå›´ï¼‰è®¿é—®Redisçš„`è¡¨çº§æ•°æ®ç´¢å¼•`ã€‚
    3.  è·å–æ‰€æœ‰ç›¸å…³çš„MinIOå¯¹è±¡å­˜å‚¨è·¯å¾„ï¼ˆå³Parquetæ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚
    4.  è®¿é—®Redisçš„`æœåŠ¡æ³¨å†Œä¿¡æ¯`ï¼Œè·å–å½“å‰æ‰€æœ‰å¥åº·çš„WorkerèŠ‚ç‚¹åˆ—è¡¨ã€‚
    5.  å°†æ–‡ä»¶åˆ—è¡¨åˆ†é…ç»™å„ä¸ªWorkerèŠ‚ç‚¹ï¼Œä¸‹å‘å­æŸ¥è¯¢ä»»åŠ¡ã€‚
    6.  ç­‰å¾…æ‰€æœ‰WorkerèŠ‚ç‚¹è¿”å›éƒ¨åˆ†ç»“æœï¼Œå¹¶å°†ç»“æœèšåˆï¼Œæœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ã€‚
*   **å†™å…¥åè°ƒå™¨ (Write Coordinator)**:
    1.  æ¥æ”¶åˆ°å†™å…¥è¯·æ±‚ï¼ŒéªŒè¯è¡¨åçš„æœ‰æ•ˆæ€§å’Œå†™å…¥æƒé™ã€‚
    2.  æ ¹æ®è¡¨åå’Œæ•°æ®ä¸­çš„`ID`ï¼Œä½¿ç”¨**ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•**ï¼ˆå­˜å‚¨åœ¨Redisä¸­ï¼‰æ¥å†³å®šè¿™æ¡æ•°æ®åº”è¯¥ç”±å“ªä¸ªWorkerèŠ‚ç‚¹å¤„ç†ã€‚
    3.  å°†æ•°æ®è¯·æ±‚è½¬å‘ç»™ç›®æ ‡WorkerèŠ‚ç‚¹ã€‚

#### b. è¿æ¥æ± ç®¡ç†å±‚ (Connection Pool Manager)

ç»Ÿä¸€ç®¡ç†ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®åº“è¿æ¥ï¼Œæä¾›é«˜æ•ˆã€å¯é çš„è¿æ¥æœåŠ¡ã€‚
*   **Redisè¿æ¥æ± ç®¡ç†å™¨**:
    1.  **å¤šæ¨¡å¼æ”¯æŒ**: æ ¹æ®é…ç½®è‡ªåŠ¨é€‚é…å•æœºã€å“¨å…µã€é›†ç¾¤ä¸‰ç§Rediséƒ¨ç½²æ¨¡å¼ã€‚
    2.  **è¿æ¥æ± ä¼˜åŒ–**: å®ç°è¿æ¥å¤ç”¨ã€é¢„çƒ­ã€è¶…æ—¶ç®¡ç†ç­‰ä¼˜åŒ–ç­–ç•¥ã€‚
    3.  **å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥Redisè¿æ¥çš„å¥åº·çŠ¶æ€ï¼ŒåŠæ—¶å‘ç°æ•…éšœèŠ‚ç‚¹ã€‚
    4.  **æ•…éšœåˆ‡æ¢**: åœ¨å“¨å…µå’Œé›†ç¾¤æ¨¡å¼ä¸‹æ”¯æŒè‡ªåŠ¨ä¸»ä»åˆ‡æ¢å’Œåˆ†ç‰‡åˆ‡æ¢ã€‚
    5.  **æ€§èƒ½ç›‘æ§**: æ”¶é›†è¿æ¥æ± ä½¿ç”¨æƒ…å†µã€å“åº”æ—¶é—´ç­‰æ€§èƒ½æŒ‡æ ‡ã€‚
*   **MinIOè¿æ¥æ± ç®¡ç†å™¨**:
    1.  **åŒæ± æ¶æ„**: ç»´æŠ¤ä¸»MinIOæ± å’Œå¤‡ä»½MinIOæ± ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»ã€‚
    2.  **è‡ªåŠ¨æ•…éšœåˆ‡æ¢**: ä¸»æ± æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ä»½æ± ï¼Œä¿è¯æœåŠ¡è¿ç»­æ€§ã€‚
    3.  **è´Ÿè½½å‡è¡¡**: åœ¨å¤šä¸ªMinIOå®ä¾‹é—´æ™ºèƒ½åˆ†é…è¯·æ±‚è´Ÿè½½ã€‚
    4.  **è¿æ¥ä¼˜åŒ–**: ä¼˜åŒ–S3è¿æ¥å‚æ•°ï¼Œæå‡ä¸Šä¼ ä¸‹è½½æ€§èƒ½ã€‚
    5.  **å¥åº·ç›‘æ§**: æŒç»­ç›‘æ§MinIOæœåŠ¡çŠ¶æ€å’Œå­˜å‚¨å®¹é‡ã€‚
*   **ç»Ÿä¸€ç®¡ç†æ¥å£**:
    1.  **é…ç½®ç®¡ç†**: ç»Ÿä¸€ç®¡ç†æ‰€æœ‰è¿æ¥æ± çš„é…ç½®å‚æ•°ã€‚
    2.  **çŠ¶æ€ç›‘æ§**: æä¾›è¿æ¥æ± çŠ¶æ€æŸ¥è¯¢å’Œç›‘æ§æ¥å£ã€‚
    3.  **åŠ¨æ€è°ƒæ•´**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´è¿æ¥æ± å‚æ•°ã€‚
    4.  **æ•…éšœå‘Šè­¦**: è¿æ¥æ•…éšœæ—¶åŠæ—¶å‘é€å‘Šè­¦é€šçŸ¥ã€‚

#### c. WorkerèŠ‚ç‚¹ (Go Service with Embedded DuckDB)

è¿™æ˜¯ç³»ç»Ÿçš„å·¥ä½œè´Ÿè½½æ ¸å¿ƒï¼Œå¯ä»¥æ°´å¹³æ‰©å±•ã€‚
*   **æœåŠ¡æ³¨å†Œä¸å¿ƒè·³**: å¯åŠ¨æ—¶ï¼Œå‘Redisæ³¨å†Œè‡ªå·±çš„åœ°å€å’Œç«¯å£ã€‚å¹¶å®šæ—¶å‘é€å¿ƒè·³ï¼Œæ›´æ–°å…¶åœ¨Redisä¸­çš„TTLï¼ˆå­˜æ´»æ—¶é—´ï¼‰ï¼Œè¡¨æ˜è‡ªå·±å¤„äºå¥åº·çŠ¶æ€ã€‚
*   **è¿æ¥æ± å®¢æˆ·ç«¯**: é€šè¿‡è¿æ¥æ± ç®¡ç†å™¨è·å–åˆ°Rediså’ŒMinIOçš„è¿æ¥ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥ã€‚
*   **è¡¨çº§æ•°æ®ç¼“å†²ä¸å†™å…¥**:
    1.  æ¥æ”¶æ¥è‡ªåè°ƒå™¨çš„æ•°æ®å†™å…¥è¯·æ±‚ï¼ŒæŒ‰è¡¨åè¿›è¡Œåˆ†ç¦»å¤„ç†ã€‚
    2.  æ•°æ®ä¸ä¼šç«‹å³å†™å…¥MinIOï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­æŒ‰è¡¨è¿›è¡Œç¼“å†²å’Œèšåˆï¼ˆä¾‹å¦‚ä½¿ç”¨Go Channelå’ŒTickerï¼‰ã€‚
    3.  æ¯ä¸ªè¡¨å¯ä»¥é…ç½®ç‹¬ç«‹çš„ç¼“å†²åŒºå¤§å°å’Œåˆ·æ–°é—´éš”ã€‚
    4.  å½“æŸä¸ªè¡¨çš„æ•°æ®è¾¾åˆ°é…ç½®çš„é˜ˆå€¼ï¼ˆå¦‚å¤§å°æˆ–æ—¶é—´é—´éš”ï¼‰ï¼Œå°†è¯¥è¡¨ç¼“å†²çš„æ•°æ®æ‰¹é‡è½¬æ¢ä¸º**Apache Parquet**æ ¼å¼ã€‚
    5.  ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶åï¼ˆå¦‚ `TABLE/ID/YYYY-MM-DD/timestamp_nanoseconds.parquet`ï¼‰ï¼Œå¹¶é€šè¿‡è¿æ¥æ± å°†å…¶ä¸Šä¼ åˆ°MinIOã€‚
    6.  ä¸Šä¼ æˆåŠŸåï¼Œåœ¨Redisçš„`è¡¨çº§æ•°æ®ç´¢å¼•`ä¸­æ·»åŠ ä¸€æ¡è®°å½•ï¼Œä¾‹å¦‚ï¼š`SADD index:table:{TABLE}:id:{ID}:{YYYY-MM-DD} file_path_in_minio`ã€‚
*   **æŸ¥è¯¢æ‰§è¡Œ**:
    1.  æ¥æ”¶åè°ƒå™¨ä¸‹å‘çš„å­æŸ¥è¯¢ä»»åŠ¡ï¼ˆåŒ…å«ä¸€ç»„MinIOä¸Šçš„Parquetæ–‡ä»¶è·¯å¾„å’Œè¡¨ä¿¡æ¯ï¼‰ã€‚
    2.  è°ƒç”¨å†…åµŒçš„DuckDB Goå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šè¡¨æŸ¥è¯¢ã€‚
    3.  æ‰§è¡ŒSQLæŸ¥è¯¢ï¼ŒDuckDBä¼šé€šè¿‡è¿æ¥æ± ä»MinIOè¯»å–è¿™äº›Parquetæ–‡ä»¶è¿›è¡Œåˆ†æã€‚
    4.  å°†æŸ¥è¯¢ç»“æœè¿”å›ç»™åè°ƒå™¨ã€‚

#### d. å…ƒæ•°æ®ç®¡ç†å±‚ (Redis)

Redisæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¤§è„‘ï¼Œå­˜å‚¨äº†æ‰€æœ‰çŠ¶æ€å’Œç´¢å¼•ä¿¡æ¯ã€‚
*   **æœåŠ¡æ³¨å†Œä¸å‘ç°**:
    *   **Key**: `nodes:services`
    *   **Type**: `HASH`
    *   **Usage**: å­˜å‚¨æ‰€æœ‰å¥åº·èŠ‚ç‚¹çš„åœ°å€ã€‚`Key`ä¸ºèŠ‚ç‚¹IDï¼Œ`Value`ä¸º`IP:Port`ã€‚èŠ‚ç‚¹é€šè¿‡å¿ƒè·³å®šæ—¶åˆ·æ–°è¿™ä¸ªKeyçš„TTLã€‚åè°ƒå™¨é€šè¿‡`HGETALL`è·å–æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ã€‚
*   **è¡¨çº§æ•°æ®ç´¢å¼•**:
    *   **Key**: `index:table:{TABLE}:id:{ID}:{YYYY-MM-DD}`
    *   **Type**: `SET`
    *   **Usage**: å­˜å‚¨æ¯ä¸ªè¡¨ã€æ¯ä¸ªIDã€æ¯å¤©å¯¹åº”çš„æ•°æ®æ–‡ä»¶ã€‚`Key`åŒ…å«äº†è¡¨åã€IDå’Œå¤©ã€‚`Value`æ˜¯å­˜å‚¨åœ¨MinIOä¸Šçš„Parquetæ–‡ä»¶è·¯å¾„é›†åˆã€‚æŸ¥è¯¢æ—¶å¯ä»¥é€šè¿‡`SMEMBERS`å¿«é€Ÿå®šä½æ–‡ä»¶ã€‚
*   **è¡¨ç®¡ç†å…ƒæ•°æ®**:
    *   **Key**: `tables:list` - å­˜å‚¨æ‰€æœ‰è¡¨å (SET)
    *   **Key**: `table:{TABLE}:config` - è¡¨é…ç½®ä¿¡æ¯ (HASH)
    *   **Key**: `table:{TABLE}:stats` - è¡¨ç»Ÿè®¡ä¿¡æ¯ (HASH)
    *   **Key**: `table:{TABLE}:created_at` - è¡¨åˆ›å»ºæ—¶é—´ (STRING)
    *   **Key**: `table:{TABLE}:last_write` - æœ€åå†™å…¥æ—¶é—´ (STRING)
*   **å…ƒæ•°æ®ç‰ˆæœ¬ç®¡ç†**:
    *   **Key**: `metadata:version` - å½“å‰å…ƒæ•°æ®ç‰ˆæœ¬å· (STRING)
    *   **Key**: `metadata:version:history` - ç‰ˆæœ¬å˜æ›´å†å² (LIST)
    *   **Key**: `metadata:backup:list` - å¤‡ä»½æ–‡ä»¶åˆ—è¡¨ (ZSETï¼ŒæŒ‰æ—¶é—´æ’åº)
    *   **Key**: `metadata:lock:{operation}` - åˆ†å¸ƒå¼é” (STRING with TTL)
*   **è¿æ¥æ± çŠ¶æ€**:
    *   **Key**: `pool:redis:status` - Redisè¿æ¥æ± çŠ¶æ€ (HASH)
    *   **Key**: `pool:minio:status` - MinIOè¿æ¥æ± çŠ¶æ€ (HASH)
    *   **Key**: `pool:health:last_check` - æœ€åå¥åº·æ£€æŸ¥æ—¶é—´ (STRING)
*   **ä¸€è‡´æ€§å“ˆå¸Œç¯**:
    *   **Key**: `cluster:hash_ring`
    *   **Type**: `Sorted Set` or `String`
    *   **Usage**: å­˜å‚¨ä¸€è‡´æ€§å“ˆå¸Œç¯çš„ä¿¡æ¯ï¼Œç”¨äºå†™å…¥æ—¶çš„åˆ†ç‰‡è·¯ç”±ã€‚å½“èŠ‚ç‚¹å¢åŠ æˆ–å‡å°‘æ—¶ï¼Œåªéœ€æ›´æ–°æ­¤æ•°æ®ç»“æ„ã€‚

#### e. åˆ†å¸ƒå¼å­˜å‚¨å±‚ (MinIO)

*   **è§’è‰²**: æœ€ç»ˆçš„æ•°æ®æ¹–ï¼ˆData Lakeï¼‰ï¼Œæä¾›å¯é ã€é«˜å¯ç”¨çš„S3å…¼å®¹å¯¹è±¡å­˜å‚¨ã€‚
*   **æ•°æ®æ ¼å¼**: **Apache Parquet**ã€‚è¿™æ˜¯ä¸€ä¸ªåˆ—å¼å­˜å‚¨æ ¼å¼ï¼Œå‹ç¼©ç‡é«˜ï¼Œéå¸¸é€‚åˆOLAPåœºæ™¯ã€‚DuckDBå¯¹å…¶æœ‰åŸç”Ÿçš„é«˜æ€§èƒ½æ”¯æŒã€‚
*   **å­˜å‚¨æ¶æ„**:
    *   **ä¸»å­˜å‚¨é›†ç¾¤**: å¤„ç†ä¸»è¦çš„è¯»å†™è¯·æ±‚ï¼Œæä¾›é«˜æ€§èƒ½è®¿é—®ã€‚
    *   **å¤‡ä»½å­˜å‚¨é›†ç¾¤**: ç”¨äºæ•°æ®å¤‡ä»½å’Œç¾éš¾æ¢å¤ï¼Œå¯ä»¥æ˜¯åœ°ç†ä½ç½®åˆ†ç¦»çš„å­˜å‚¨ã€‚
*   **æ•°æ®ç»„ç»‡**:
    *   **Bucket**: å¯ä»¥æŒ‰ä¸šåŠ¡æˆ–ç§Ÿæˆ·åˆ’åˆ†ï¼Œä¾‹å¦‚ `olap-data`ã€`olap-backup`ã€‚
    *   **Object Key (è·¯å¾„)**: ä¸¥æ ¼æŒ‰ç…§ `TABLE/ID/YYYY-MM-DD/` çš„æ ¼å¼ç»„ç»‡ã€‚ä¾‹å¦‚ï¼š
        - `users/user-123/2024-01-15/1705123456789.parquet`
        - `orders/order-456/2024-01-15/1705123456790.parquet`
        - `logs/app-logs/2024-01-15/1705123456791.parquet`
*   **å¤‡ä»½æ•°æ®ç»„ç»‡**:
    *   **å…ƒæ•°æ®å¤‡ä»½**: `metadata/backups/YYYY-MM-DD/backup_timestamp.json`
    *   **æ•°æ®å¤‡ä»½**: ä¸ä¸»å­˜å‚¨ç›¸åŒçš„è·¯å¾„ç»“æ„ï¼Œä½†å­˜å‚¨åœ¨å¤‡ä»½bucketä¸­

## 4. æ ¸å¿ƒæµç¨‹åˆ†æ

### 4.0. éƒ¨ç½²æ¨¡å¼é€‰æ‹©

ç³»ç»Ÿæ”¯æŒä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„`redis.enabled`å¼€å…³è¿›è¡Œæ§åˆ¶ï¼š

#### 4.0.1. å•èŠ‚ç‚¹æ¨¡å¼ï¼ˆæ¨èç”¨äºå¼€å‘/æµ‹è¯•ï¼‰
- **é…ç½®æ–¹å¼**: `redis.enabled: false`
- **é€‚ç”¨åœºæ™¯**: å¼€å‘æµ‹è¯•ã€èµ„æºå—é™ç¯å¢ƒã€é¡¹ç›®åˆæœŸ
- **ä¼˜åŠ¿**: éƒ¨ç½²ç®€å•ã€æ— éœ€Redisã€èµ„æºå ç”¨å°‘
- **ç»„ä»¶éœ€æ±‚**: ä»…éœ€MinIO + MinIODBæœåŠ¡

#### 4.0.2. åˆ†å¸ƒå¼æ¨¡å¼ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰
- **é…ç½®æ–¹å¼**: `redis.enabled: true`
- **é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒã€é«˜å¯ç”¨éœ€æ±‚ã€å¤§è§„æ¨¡æ•°æ®å¤„ç†
- **ä¼˜åŠ¿**: é«˜å¯ç”¨ã€æ°´å¹³æ‰©å±•ã€è´Ÿè½½å‡è¡¡
- **ç»„ä»¶éœ€æ±‚**: Redis + MinIOé›†ç¾¤ + MinIODBæœåŠ¡é›†ç¾¤

### 4.1. èŠ‚ç‚¹æ³¨å†Œä¸å‘ç°

#### 4.1.1. åˆ†å¸ƒå¼æ¨¡å¼ä¸‹çš„èŠ‚ç‚¹æ³¨å†Œä¸å‘ç°
1.  ä¸€ä¸ªæ–°çš„GoæœåŠ¡å®ä¾‹ï¼ˆWorker Nodeï¼‰å¯åŠ¨ã€‚
2.  å®ƒè¿æ¥åˆ°Redisï¼Œå¹¶åœ¨`nodes:services`å“ˆå¸Œè¡¨ä¸­æ·»åŠ è‡ªå·±çš„`NodeID`å’Œ`IP:Port`ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªTTLï¼ˆå¦‚60ç§’ï¼‰ã€‚
3.  è¯¥èŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚æ¯30ç§’ï¼‰ï¼Œé‡å¤ä¸Šä¸€æ­¥ï¼Œä»¥åˆ·æ–°TTLï¼Œè¿™ä½œä¸ºå¿ƒè·³æœºåˆ¶ã€‚
4.  æŸ¥è¯¢åè°ƒå™¨éœ€è¦æŸ¥æ‰¾å¯ç”¨èŠ‚ç‚¹æ—¶ï¼Œåªéœ€ä»`nodes:services`è¯»å–æ‰€æœ‰æˆå‘˜å³å¯ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰åœ¨TTLå†…ç»­æœŸï¼Œå®ƒä¼šè‡ªåŠ¨ä»å“ˆå¸Œè¡¨ä¸­æ¶ˆå¤±ã€‚

#### 4.1.2. å•èŠ‚ç‚¹æ¨¡å¼ä¸‹çš„æœåŠ¡å¤„ç†
1.  MinIODBæœåŠ¡å¯åŠ¨æ—¶æ£€æµ‹åˆ°`redis.enabled: false`é…ç½®ã€‚
2.  è‡ªåŠ¨è·³è¿‡Redisè¿æ¥æ± åˆ›å»ºå’ŒæœåŠ¡æ³¨å†Œæµç¨‹ã€‚
3.  æ‰€æœ‰æŸ¥è¯¢å’Œå†™å…¥æ“ä½œç›´æ¥è·¯ç”±åˆ°æœ¬åœ°èŠ‚ç‚¹ã€‚
4.  æœåŠ¡å‘ç°è¿”å›å½“å‰æœ¬åœ°èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ ‡è®°ä¸ºå•èŠ‚ç‚¹æ¨¡å¼ã€‚
5.  æ— éœ€å¿ƒè·³æœºåˆ¶å’Œåˆ†å¸ƒå¼åè°ƒï¼Œç®€åŒ–äº†ç³»ç»Ÿå¤æ‚åº¦ã€‚

### 4.2. è¡¨ç®¡ç†æµç¨‹

#### 4.2.1. åˆ†å¸ƒå¼æ¨¡å¼ä¸‹çš„è¡¨ç®¡ç†
1. **åˆ›å»ºè¡¨**: å®¢æˆ·ç«¯å‘é€åˆ›å»ºè¡¨è¯·æ±‚ï¼ŒæŒ‡å®šè¡¨åå’Œé…ç½®å‚æ•°ã€‚
2. **éªŒè¯è¡¨å**: ç³»ç»ŸéªŒè¯è¡¨åçš„åˆæ³•æ€§ï¼ˆç¬¦åˆå‘½åè§„èŒƒã€ä¸é‡å¤ç­‰ï¼‰ã€‚
3. **å­˜å‚¨å…ƒæ•°æ®**: åœ¨Redisä¸­å­˜å‚¨è¡¨çš„é…ç½®ä¿¡æ¯ã€åˆ›å»ºæ—¶é—´ç­‰å…ƒæ•°æ®ã€‚
4. **æ›´æ–°è¡¨åˆ—è¡¨**: å°†æ–°è¡¨åæ·»åŠ åˆ°`tables:list`é›†åˆä¸­ã€‚
5. **åˆå§‹åŒ–ç»Ÿè®¡**: ä¸ºæ–°è¡¨åˆå§‹åŒ–ç»Ÿè®¡ä¿¡æ¯ï¼ˆè®°å½•æ•°ã€æ–‡ä»¶æ•°ã€å¤§å°ç­‰ï¼‰ã€‚

#### 4.2.2. å•èŠ‚ç‚¹æ¨¡å¼ä¸‹çš„è¡¨ç®¡ç†
1. **åˆ›å»ºè¡¨**: å®¢æˆ·ç«¯å‘é€åˆ›å»ºè¡¨è¯·æ±‚ï¼ŒæŒ‡å®šè¡¨åå’Œé…ç½®å‚æ•°ã€‚
2. **éªŒè¯è¡¨å**: ç³»ç»ŸéªŒè¯è¡¨åçš„åˆæ³•æ€§ï¼ˆç¬¦åˆå‘½åè§„èŒƒã€ä¸é‡å¤ç­‰ï¼‰ã€‚
3. **æœ¬åœ°å­˜å‚¨**: åœ¨æœ¬åœ°å†…å­˜ä¸­ç»´æŠ¤è¡¨é…ç½®ä¿¡æ¯å’Œå…ƒæ•°æ®ã€‚
4. **æœ¬åœ°ç´¢å¼•**: åœ¨æœ¬åœ°ç»´æŠ¤è¡¨åˆ—è¡¨å’Œç»Ÿè®¡ä¿¡æ¯ã€‚
5. **ç›´æ¥è®¿é—®**: æ‰€æœ‰è¡¨æ“ä½œç›´æ¥é€šè¿‡æœ¬åœ°é€»è¾‘å¤„ç†ï¼Œæ— éœ€Redisåè°ƒã€‚

### 4.3. è¡¨çº§æ•°æ®å†™å…¥ä¸åˆ†ç‰‡

#### 4.3.1. åˆ†å¸ƒå¼æ¨¡å¼ä¸‹çš„æ•°æ®å†™å…¥
1.  å®¢æˆ·ç«¯å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„APIç½‘å…³å‘é€å†™å…¥è¯·æ±‚ `(TABLE, ID, Time, DataPayload)`ã€‚
2.  è¯¥èŠ‚ç‚¹ï¼ˆä½œä¸ºåè°ƒå™¨ï¼‰éªŒè¯è¡¨çš„å­˜åœ¨æ€§å’Œå†™å…¥æƒé™ã€‚
3.  ä»Redisè·å–`cluster:hash_ring`ï¼Œæ ¹æ®è¡¨åå’Œæ•°æ®ä¸­çš„`ID`è®¡ç®—å‡ºåº”è¯¥å¤„ç†æ­¤æ•°æ®çš„Worker Nodeã€‚
4.  åè°ƒå™¨å°†è¯·æ±‚è½¬å‘ç»™ç›®æ ‡Worker Nodeã€‚
5.  Worker Nodeæ ¹æ®è¡¨çš„é…ç½®åœ¨å†…å­˜ä¸­ç¼“å†²æ•°æ®ã€‚
6.  å½“æŸä¸ªè¡¨çš„ç¼“å†²åŒºæ»¡æˆ–è¾¾åˆ°æ—¶é—´é˜ˆå€¼ï¼ŒWorker Nodeå°†è¿™æ‰¹æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå±äºåŒä¸€ä¸ªè¡¨ã€åŒä¸€ä¸ªIDå’ŒåŒä¸€å¤©ï¼‰èšåˆå¹¶ç”Ÿæˆä¸€ä¸ªParquetæ–‡ä»¶ã€‚
7.  Worker Nodeå°†Parquetæ–‡ä»¶ä¸Šä¼ åˆ°MinIOï¼Œè·¯å¾„ä¸º `bucket-name/TABLE/ID/YYYY-MM-DD/nanotimestamp.parquet`ã€‚
8.  ä¸Šä¼ æˆåŠŸåï¼ŒWorker Nodeæ›´æ–°Redisç´¢å¼•ï¼š`SADD index:table:{TABLE}:id:{ID}:{YYYY-MM-DD} "TABLE/ID/YYYY-MM-DD/nanotimestamp.parquet"`ã€‚
9.  æ›´æ–°è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®°å½•æ•°ã€æ–‡ä»¶æ•°ã€æœ€åå†™å…¥æ—¶é—´ç­‰ã€‚

#### 4.3.2. å•èŠ‚ç‚¹æ¨¡å¼ä¸‹çš„æ•°æ®å†™å…¥
1.  å®¢æˆ·ç«¯å‘MinIODBæœåŠ¡å‘é€å†™å…¥è¯·æ±‚ `(TABLE, ID, Time, DataPayload)`ã€‚
2.  æœåŠ¡éªŒè¯è¡¨çš„å­˜åœ¨æ€§å’Œå†™å…¥æƒé™ã€‚
3.  ç›´æ¥è·¯ç”±åˆ°æœ¬åœ°èŠ‚ç‚¹å¤„ç†ï¼ˆæ— éœ€ä¸€è‡´æ€§å“ˆå¸Œè®¡ç®—ï¼‰ã€‚
4.  æœ¬åœ°èŠ‚ç‚¹æ ¹æ®è¡¨çš„é…ç½®åœ¨å†…å­˜ä¸­ç¼“å†²æ•°æ®ã€‚
5.  å½“æŸä¸ªè¡¨çš„ç¼“å†²åŒºæ»¡æˆ–è¾¾åˆ°æ—¶é—´é˜ˆå€¼ï¼Œæœ¬åœ°èŠ‚ç‚¹å°†è¿™æ‰¹æ•°æ®èšåˆå¹¶ç”Ÿæˆä¸€ä¸ªParquetæ–‡ä»¶ã€‚
6.  æœ¬åœ°èŠ‚ç‚¹å°†Parquetæ–‡ä»¶ä¸Šä¼ åˆ°MinIOï¼Œè·¯å¾„ä¸º `bucket-name/TABLE/ID/YYYY-MM-DD/nanotimestamp.parquet`ã€‚
7.  ä¸Šä¼ æˆåŠŸåï¼Œåœ¨æœ¬åœ°ç»´æŠ¤æ–‡ä»¶ç´¢å¼•ä¿¡æ¯ï¼ˆæ— éœ€Redisï¼‰ã€‚
8.  æ›´æ–°æœ¬åœ°è¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬è®°å½•æ•°ã€æ–‡ä»¶æ•°ã€æœ€åå†™å…¥æ—¶é—´ç­‰ã€‚

### 4.4. è¡¨çº§æ•°æ®æŸ¥è¯¢

#### 4.4.1. åˆ†å¸ƒå¼æ¨¡å¼ä¸‹çš„æ•°æ®æŸ¥è¯¢
1.  å®¢æˆ·ç«¯å‘ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„APIç½‘å…³å‘é€æŸ¥è¯¢è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼ŒSQL: `SELECT * FROM users WHERE id = 'user-123' AND timestamp >= '2024-01-01'`ï¼‰ã€‚
2.  åè°ƒå™¨è§£æSQLï¼Œæå–è¡¨åï¼ˆå¦‚`users`ï¼‰ï¼ŒéªŒè¯è¡¨çš„å­˜åœ¨æ€§å’ŒæŸ¥è¯¢æƒé™ã€‚
3.  æ ¹æ®WHEREæ¡ä»¶ï¼Œç”Ÿæˆéœ€è¦æŸ¥è¯¢çš„`{TABLE}`ã€`{ID}`å’Œ`{YYYY-MM-DD}`çš„ç»„åˆã€‚
4.  åè°ƒå™¨å¹¶å‘åœ°å‘RedisæŸ¥è¯¢æ‰€æœ‰åŒ¹é…çš„Keyï¼ˆå¦‚ `KEYS index:table:users:id:user-123:*`ï¼‰ï¼Œå¹¶è·å–æ‰€æœ‰ç›¸å…³çš„Parquetæ–‡ä»¶è·¯å¾„åˆ—è¡¨ã€‚
5.  åè°ƒå™¨è·å–`nodes:services`ä¸­çš„æ‰€æœ‰å¥åº·WorkerèŠ‚ç‚¹ï¼Œå¹¶åˆ¶å®šæŸ¥è¯¢è®¡åˆ’ï¼ˆä¾‹å¦‚ï¼Œå¹³å‡åˆ†é…æ–‡ä»¶åˆ—è¡¨ï¼‰ã€‚
6.  åè°ƒå™¨å‘æ¯ä¸ªWorker Nodeä¸‹å‘å­æŸ¥è¯¢ä»»åŠ¡ï¼ŒåŒ…å«æ–‡ä»¶åˆ—è¡¨å’Œè¦æ‰§è¡Œçš„SQLè¯­å¥ã€‚
7.  æ¯ä¸ªWorker Nodeçš„DuckDBå®ä¾‹æ‰§è¡ŒæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š`SELECT * FROM read_parquet(['s3://olap-data/users/user-123/2024-01-01/file1.parquet', 's3://olap-data/users/user-123/2024-01-02/file2.parquet']) WHERE ...`ã€‚DuckDBä¼šè‡ªåŠ¨å¤„ç†S3è®¤è¯å’Œæ•°æ®è¯»å–ã€‚
8.  Worker Nodeå°†éƒ¨åˆ†ç»“æœè¿”å›ç»™åè°ƒå™¨ã€‚
9.  åè°ƒå™¨èšåˆæ‰€æœ‰ç»“æœï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚

#### 4.4.2. å•èŠ‚ç‚¹æ¨¡å¼ä¸‹çš„æ•°æ®æŸ¥è¯¢
1.  å®¢æˆ·ç«¯å‘MinIODBæœåŠ¡å‘é€æŸ¥è¯¢è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼ŒSQL: `SELECT * FROM users WHERE id = 'user-123' AND timestamp >= '2024-01-01'`ï¼‰ã€‚
2.  æœåŠ¡è§£æSQLï¼Œæå–è¡¨åï¼ˆå¦‚`users`ï¼‰ï¼ŒéªŒè¯è¡¨çš„å­˜åœ¨æ€§å’ŒæŸ¥è¯¢æƒé™ã€‚
3.  æ ¹æ®WHEREæ¡ä»¶ï¼Œç”Ÿæˆéœ€è¦æŸ¥è¯¢çš„`{TABLE}`ã€`{ID}`å’Œ`{YYYY-MM-DD}`çš„ç»„åˆã€‚
4.  ç›´æ¥æ‰«æMinIOè·¯å¾„`TABLE/ID/YYYY-MM-DD/`è·å–ç›¸å…³çš„Parquetæ–‡ä»¶è·¯å¾„åˆ—è¡¨ï¼ˆæ— éœ€Redisç´¢å¼•ï¼‰ã€‚
5.  æœ¬åœ°DuckDBå®ä¾‹æ‰§è¡ŒæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š`SELECT * FROM read_parquet(['s3://olap-data/users/user-123/2024-01-01/file1.parquet', 's3://olap-data/users/user-123/2024-01-02/file2.parquet']) WHERE ...`ã€‚
6.  ç›´æ¥è¿”å›æŸ¥è¯¢ç»“æœç»™å®¢æˆ·ç«¯ï¼ˆæ— éœ€ç»“æœèšåˆï¼‰ã€‚

### 4.5. å¤šè¡¨æŸ¥è¯¢æµç¨‹
1.  å®¢æˆ·ç«¯å‘é€åŒ…å«å¤šè¡¨JOINçš„SQLæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š`SELECT u.name, COUNT(o.id) FROM users u LEFT JOIN orders o ON u.id = o.user_id GROUP BY u.name`ã€‚
2.  åè°ƒå™¨è§£æSQLï¼Œæå–æ‰€æœ‰æ¶‰åŠçš„è¡¨åï¼ˆ`users`, `orders`ï¼‰ï¼ŒéªŒè¯è¡¨çš„å­˜åœ¨æ€§å’ŒæŸ¥è¯¢æƒé™ã€‚
3.  ä¸ºæ¯ä¸ªè¡¨åˆ†åˆ«è·å–ç›¸å…³çš„Parquetæ–‡ä»¶è·¯å¾„åˆ—è¡¨ã€‚
4.  åè°ƒå™¨åˆ¶å®šå¤šè¡¨æŸ¥è¯¢è®¡åˆ’ï¼Œå°†ä¸åŒè¡¨çš„æ–‡ä»¶åˆ†é…ç»™WorkerèŠ‚ç‚¹ã€‚
5.  WorkerèŠ‚ç‚¹åœ¨DuckDBä¸­åˆ›å»ºè™šæ‹Ÿè¡¨ï¼ˆVIEWï¼‰ï¼Œæ¯ä¸ªè¡¨å¯¹åº”ä¸€ç»„Parquetæ–‡ä»¶ã€‚
6.  æ‰§è¡ŒåŸå§‹çš„å¤šè¡¨JOIN SQLï¼ŒDuckDBè‡ªåŠ¨å¤„ç†è¡¨é—´å…³è”ã€‚
7.  è¿”å›èšåˆç»“æœç»™å®¢æˆ·ç«¯ã€‚

### 4.6. èŠ‚ç‚¹æ‰©å®¹
1.  å¯åŠ¨ä¸€ä¸ªæ–°çš„Worker Nodeå®ä¾‹ã€‚
2.  å®ƒä¼šè‡ªåŠ¨æ‰§è¡Œ[5.1](#51-èŠ‚ç‚¹æ³¨å†Œä¸å‘ç°)ä¸­çš„æ³¨å†Œæµç¨‹ã€‚
3.  ä¸€ä¸ªç‹¬ç«‹çš„æ§åˆ¶å™¨æˆ–ç”±ä¸»èŠ‚ç‚¹æ£€æµ‹åˆ°`nodes:services`å‘ç”Ÿå˜åŒ–ï¼Œä¼šé‡æ–°è®¡ç®—`cluster:hash_ring`å¹¶æ›´æ–°åˆ°Redisä¸­ã€‚
4.  æ­¤åï¼Œæ–°çš„æ•°æ®å†™å…¥è¯·æ±‚ä¼šæ ¹æ®æ–°ç¯çš„è§„åˆ™ï¼Œè‡ªåŠ¨å¼€å§‹å‘æ–°èŠ‚ç‚¹åˆ†å‘ï¼Œå®ç°äº†è‡ªåŠ¨åŒ–çš„æ•°æ®åˆ†ç‰‡æ‰©å±•ã€‚
5.  **æ³¨æ„**: æ­¤æ–¹æ¡ˆä¸­ï¼Œå†å²æ•°æ®ä¸ä¼šè‡ªåŠ¨è¿ç§»ï¼Œå®ƒä»ç„¶ä¿ç•™åœ¨åŸæ¥çš„ä½ç½®ã€‚ä½†ç”±äºæŸ¥è¯¢æ˜¯åŸºäºRedisçš„å…¨å±€ç´¢å¼•ï¼Œæ— è®ºæ–‡ä»¶æ˜¯å“ªä¸ªèŠ‚ç‚¹å†™å…¥çš„ï¼Œéƒ½èƒ½è¢«æ­£ç¡®æŸ¥è¯¢åˆ°ã€‚è¿™å¤§å¤§ç®€åŒ–äº†æ‰©å®¹é€»è¾‘ï¼Œç¬¦åˆè½»é‡åŒ–çš„è®¾è®¡ç†å¿µã€‚å¦‚æœéœ€è¦å†å²æ•°æ®é‡åˆ†å¸ƒï¼Œå¯ä»¥å¼€å‘ä¸€ä¸ªç¦»çº¿çš„ã€ä½ä¼˜å…ˆçº§çš„åå°ä»»åŠ¡æ¥å®Œæˆã€‚

### 4.7. æ•°æ®å¤‡ä»½ä¸é«˜å¯ç”¨
ä¸ºäº†è§£å†³å°†æ¯ä¸ªMinIOå®ä¾‹è§†ä¸ºç‹¬ç«‹å­˜å‚¨èŠ‚ç‚¹è€Œå¸¦æ¥çš„å•ç‚¹æ•…éšœé£é™©ï¼Œç³»ç»Ÿå¼•å…¥äº†æ•°æ®å¤‡ä»½æœºåˆ¶ã€‚

#### a. è‡ªåŠ¨å¤‡ä»½
- **è§¦å‘æ—¶æœº**: å½“å†…å­˜ç¼“å†²åŒºçš„æ•°æ®æˆåŠŸå†™å…¥ä¸»å­˜å‚¨èŠ‚ç‚¹åè§¦å‘ã€‚
- **é€»è¾‘**: å¦‚æœé…ç½®æ–‡ä»¶ä¸­å¯ç”¨äº†è‡ªåŠ¨å¤‡ä»½ï¼Œ`SharedBuffer`æœåŠ¡ä¼šç«‹å³å‘èµ·ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå°†åˆšåˆšä¸Šä¼ åˆ°ä¸»èŠ‚ç‚¹çš„Parquetæ–‡ä»¶å†æ¬¡ä¸Šä¼ åˆ°æŒ‡å®šçš„å¤‡ä»½å­˜å‚¨èŠ‚ç‚¹ã€‚
- **å¥å£®æ€§**: ä¸»æµç¨‹çš„æˆåŠŸä¸å—å¤‡ä»½æµç¨‹å½±å“ã€‚å¦‚æœå¤‡ä»½å¤±è´¥ï¼Œç³»ç»Ÿä¼šè®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¸ºåç»­å®ç°é‡è¯•æœºåˆ¶ï¼ˆå¦‚åŸºäºRedisçš„å¤±è´¥ä»»åŠ¡é˜Ÿåˆ—ï¼‰æä¾›åŸºç¡€ã€‚
- **è¡¨çº§é…ç½®**: æ¯ä¸ªè¡¨å¯ä»¥ç‹¬ç«‹é…ç½®æ˜¯å¦å¯ç”¨å¤‡ä»½ï¼Œæ”¯æŒå·®å¼‚åŒ–çš„å¤‡ä»½ç­–ç•¥ã€‚

#### b. æ‰‹åŠ¨å¤‡ä»½
- **APIæ¥å£**: æä¾›`POST /v1/backup/trigger` (RESTful) å’Œ `rpc TriggerBackup(...)` (gRPC)æ¥å£ã€‚
- **åŠŸèƒ½**: è°ƒç”¨è€…å¯ä»¥æŒ‡å®š`è¡¨å`ã€`ID`å’Œ`æ—¥æœŸ`ï¼Œæ‰‹åŠ¨è§¦å‘å¯¹è¿™éƒ¨åˆ†æ•°æ®çš„å¤‡ä»½ã€‚
- **é€»è¾‘**: æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œä¼šæ‰«æä¸»å­˜å‚¨èŠ‚ç‚¹ä¸Šå¯¹åº”è¡¨çš„æ‰€æœ‰Parquetæ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬é€ä¸€å¤åˆ¶åˆ°å¤‡ä»½å­˜å‚¨èŠ‚ç‚¹ã€‚æ­¤åŠŸèƒ½å¯ç”¨äºæ•°æ®æ¢å¤ã€è¿ç§»æˆ–å¯¹ç‰¹å®šé‡è¦æ•°æ®è¿›è¡Œå¼ºåˆ¶å¤‡ä»½ã€‚

### 4.8. è¿æ¥æ± ç®¡ç†æµç¨‹

#### a. è¿æ¥æ± åˆå§‹åŒ–æµç¨‹
1. **ç³»ç»Ÿå¯åŠ¨é˜¶æ®µ**:
   - è¯»å–è¿æ¥æ± é…ç½®ï¼ˆRedisæ¨¡å¼ã€MinIOé›†ç¾¤ä¿¡æ¯ç­‰ï¼‰
   - åˆ›å»ºè¿æ¥æ± ç®¡ç†å™¨å®ä¾‹
   - æ ¹æ®é…ç½®åˆå§‹åŒ–Redisè¿æ¥æ± ï¼ˆå•æœº/å“¨å…µ/é›†ç¾¤ï¼‰
   - åˆå§‹åŒ–MinIOè¿æ¥æ± ï¼ˆä¸»æ± /å¤‡ä»½æ± ï¼‰

2. **è¿æ¥æ± é¢„çƒ­**:
   - åˆ›å»ºåˆå§‹è¿æ¥æ•°é‡çš„è¿æ¥åˆ°è¿æ¥æ± 
   - éªŒè¯æ‰€æœ‰åˆå§‹è¿æ¥çš„æœ‰æ•ˆæ€§
   - è®°å½•è¿æ¥æ± åˆå§‹åŒ–çŠ¶æ€å’Œæ€§èƒ½åŸºå‡†

3. **å¥åº·æ£€æŸ¥æœºåˆ¶å¯åŠ¨**:
   - å¯åŠ¨å®šæ—¶å¥åº·æ£€æŸ¥ä»»åŠ¡ï¼ˆé»˜è®¤æ¯30ç§’ï¼‰
   - æ£€æŸ¥Redisè¿æ¥çš„å“åº”æ—¶é—´å’Œå¯ç”¨æ€§
   - æ£€æŸ¥MinIOè¿æ¥çš„å­˜å‚¨çŠ¶æ€å’Œè®¿é—®æƒé™
   - å°†å¥åº·æ£€æŸ¥ç»“æœæ›´æ–°åˆ°Rediså…ƒæ•°æ®ä¸­

#### b. è¿æ¥è·å–ä¸é‡Šæ”¾æµç¨‹
1. **è¿æ¥è¯·æ±‚å¤„ç†**:
   - WorkerèŠ‚ç‚¹è¯·æ±‚Redis/MinIOè¿æ¥
   - è¿æ¥æ± ç®¡ç†å™¨æ£€æŸ¥è¿æ¥æ± çŠ¶æ€
   - å¦‚æœæœ‰å¯ç”¨è¿æ¥ï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™åˆ›å»ºæ–°è¿æ¥
   - è®°å½•è¿æ¥ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯

2. **è¿æ¥å¥åº·éªŒè¯**:
   - è¿”å›è¿æ¥å‰éªŒè¯è¿æ¥æœ‰æ•ˆæ€§
   - å¯¹äºæ— æ•ˆè¿æ¥ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°è¿æ¥æ›¿ä»£
   - æ›´æ–°è¿æ¥æ± å¥åº·çŠ¶æ€æŒ‡æ ‡

3. **è¿æ¥å›æ”¶ç®¡ç†**:
   - ç›‘æ§è¿æ¥ä½¿ç”¨æ—¶é•¿ï¼Œè¶…æ—¶è‡ªåŠ¨å›æ”¶
   - å®šæœŸæ¸…ç†é•¿æ—¶é—´æœªä½¿ç”¨çš„è¿æ¥
   - ç»´æŠ¤è¿æ¥æ± å¤§å°åœ¨é…ç½®èŒƒå›´å†…

#### c. æ•…éšœæ£€æµ‹ä¸åˆ‡æ¢æµç¨‹
1. **Redisæ•…éšœå¤„ç†**:
   - æ£€æµ‹åˆ°Redisä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè§¦å‘æ•…éšœåˆ‡æ¢
   - åœ¨å“¨å…µæ¨¡å¼ä¸‹ï¼Œè‡ªåŠ¨å‘ç°æ–°çš„ä¸»èŠ‚ç‚¹
   - åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œé‡æ–°è·¯ç”±åˆ°å¥åº·çš„åˆ†ç‰‡èŠ‚ç‚¹
   - æ›´æ–°è¿æ¥æ± é…ç½®å’Œè·¯ç”±è¡¨

2. **MinIOæ•…éšœå¤„ç†**:
   - æ£€æµ‹åˆ°ä¸»MinIOæ± æ•…éšœæ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ä»½æ± 
   - é€šçŸ¥æ‰€æœ‰WorkerèŠ‚ç‚¹æ›´æ–°MinIOè¿æ¥é…ç½®
   - å¯åŠ¨ä¸»æ± æ¢å¤æ£€æµ‹ï¼Œæ¢å¤åè‡ªåŠ¨åˆ‡å›
   - è®°å½•æ•…éšœåˆ‡æ¢æ—¥å¿—å’Œæ€§èƒ½å½±å“

3. **è¿æ¥æ± æ‰©ç¼©å®¹**:
   - æ ¹æ®è´Ÿè½½æƒ…å†µåŠ¨æ€è°ƒæ•´è¿æ¥æ± å¤§å°
   - é«˜è´Ÿè½½æ—¶è‡ªåŠ¨å¢åŠ è¿æ¥æ•°
   - ä½è´Ÿè½½æ—¶å›æ”¶å¤šä½™è¿æ¥ï¼ŒèŠ‚çœèµ„æº
   - ä¿è¯è¿æ¥æ± å¤§å°åœ¨æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´

### 4.9. å…ƒæ•°æ®å¤‡ä»½æ¢å¤æµç¨‹

#### a. ç‰ˆæœ¬ç®¡ç†æµç¨‹
1. **ç³»ç»Ÿå¯åŠ¨ç‰ˆæœ¬æ£€æŸ¥**:
   - èŠ‚ç‚¹å¯åŠ¨æ—¶ä»Redisè¯»å–å½“å‰å…ƒæ•°æ®ç‰ˆæœ¬
   - æ¯”è¾ƒæœ¬åœ°ç¼“å­˜ç‰ˆæœ¬ä¸Redisç‰ˆæœ¬
   - å¦‚æœç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œè§¦å‘åŒæ­¥æµç¨‹
   - è®°å½•ç‰ˆæœ¬æ£€æŸ¥ç»“æœå’ŒåŒæ­¥çŠ¶æ€

2. **ç‰ˆæœ¬å†²çªæ£€æµ‹**:
   - å¤šä¸ªèŠ‚ç‚¹åŒæ—¶ä¿®æ”¹å…ƒæ•°æ®æ—¶ï¼Œæ£€æµ‹ç‰ˆæœ¬å†²çª
   - ä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢å¹¶å‘ä¿®æ”¹
   - å†²çªå‘ç”Ÿæ—¶ï¼Œé‡‡ç”¨"æœ€åå†™å…¥è·èƒœ"æˆ–"åˆå¹¶ç­–ç•¥"
   - è®°å½•å†²çªè§£å†³è¿‡ç¨‹å’Œç»“æœ

3. **ç‰ˆæœ¬æ›´æ–°åŒæ­¥**:
   - å…ƒæ•°æ®ä¿®æ”¹æ—¶ï¼Œå…ˆè·å–åˆ†å¸ƒå¼é”
   - æ›´æ–°å…ƒæ•°æ®ç‰ˆæœ¬å·ï¼ˆé‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼‰
   - å°†ç‰ˆæœ¬å˜æ›´è®°å½•åˆ°å†å²æ—¥å¿—
   - é€šçŸ¥å…¶ä»–èŠ‚ç‚¹è¿›è¡Œç‰ˆæœ¬åŒæ­¥

#### b. è‡ªåŠ¨å¤‡ä»½æµç¨‹
1. **å®šæ—¶å¤‡ä»½è§¦å‘**:
   - æ ¹æ®é…ç½®çš„å¤‡ä»½é—´éš”ï¼ˆå¦‚æ¯å°æ—¶ã€æ¯å¤©ï¼‰è§¦å‘å¤‡ä»½
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–èŠ‚ç‚¹æ­£åœ¨æ‰§è¡Œå¤‡ä»½ï¼ˆåˆ†å¸ƒå¼é”ï¼‰
   - è·å–å¤‡ä»½é”åï¼Œå¼€å§‹å¤‡ä»½æµç¨‹

2. **å…ƒæ•°æ®æ”¶é›†**:
   - ä»Redisæ”¶é›†æ‰€æœ‰è¡¨å…ƒæ•°æ®ã€ç´¢å¼•ä¿¡æ¯
   - æ”¶é›†æœåŠ¡æ³¨å†Œä¿¡æ¯ã€é…ç½®ä¿¡æ¯
   - æ”¶é›†è¿æ¥æ± çŠ¶æ€å’Œæ€§èƒ½ç»Ÿè®¡
   - ç”Ÿæˆå®Œæ•´çš„å…ƒæ•°æ®å¿«ç…§

3. **å¤‡ä»½æ–‡ä»¶ç”Ÿæˆ**:
   - å°†å…ƒæ•°æ®å¿«ç…§åºåˆ—åŒ–ä¸ºJSONæ ¼å¼
   - æ·»åŠ å¤‡ä»½æ—¶é—´æˆ³å’Œç‰ˆæœ¬ä¿¡æ¯
   - è®¡ç®—å¤‡ä»½æ–‡ä»¶çš„æ ¡éªŒå’Œ
   - ä¸Šä¼ å¤‡ä»½æ–‡ä»¶åˆ°MinIOå¤‡ä»½å­˜å‚¨

4. **å¤‡ä»½ç´¢å¼•æ›´æ–°**:
   - å°†æ–°å¤‡ä»½ä¿¡æ¯æ·»åŠ åˆ°å¤‡ä»½æ–‡ä»¶åˆ—è¡¨
   - æ¸…ç†è¿‡æœŸçš„å¤‡ä»½æ–‡ä»¶ï¼ˆæ ¹æ®ä¿ç•™ç­–ç•¥ï¼‰
   - æ›´æ–°å¤‡ä»½ç»Ÿè®¡ä¿¡æ¯
   - é‡Šæ”¾åˆ†å¸ƒå¼é”

#### c. æ¢å¤æµç¨‹
1. **æ¢å¤è¯·æ±‚å¤„ç†**:
   - éªŒè¯æ¢å¤è¯·æ±‚çš„æƒé™å’Œå‚æ•°
   - è·å–æ¢å¤æ“ä½œçš„åˆ†å¸ƒå¼é”
   - æ£€æŸ¥æŒ‡å®šçš„å¤‡ä»½æ–‡ä»¶æ˜¯å¦å­˜åœ¨å’Œæœ‰æ•ˆ

2. **å¤‡ä»½æ–‡ä»¶éªŒè¯**:
   - ä¸‹è½½æŒ‡å®šçš„å¤‡ä»½æ–‡ä»¶
   - éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆæ ¡éªŒå’Œï¼‰
   - è§£æå¤‡ä»½æ–‡ä»¶å†…å®¹
   - æ£€æŸ¥å¤‡ä»½ç‰ˆæœ¬ä¸å½“å‰ç³»ç»Ÿçš„å…¼å®¹æ€§

3. **æ•°æ®æ¢å¤æ‰§è¡Œ**:
   - æ ¹æ®æ¢å¤æ¨¡å¼ï¼ˆå®Œæ•´/å¢é‡/é€‰æ‹©æ€§ï¼‰æ‰§è¡Œæ¢å¤
   - å¤‡ä»½å½“å‰å…ƒæ•°æ®ï¼ˆå¦‚æœé…ç½®äº†å¤‡ä»½é€‰é¡¹ï¼‰
   - æ¸…ç†æˆ–åˆå¹¶ç°æœ‰å…ƒæ•°æ®
   - å¯¼å…¥å¤‡ä»½çš„å…ƒæ•°æ®åˆ°Redis

4. **ä¸€è‡´æ€§æ£€æŸ¥**:
   - éªŒè¯æ¢å¤åçš„æ•°æ®å®Œæ•´æ€§
   - æ£€æŸ¥è¡¨ç´¢å¼•å’Œæ–‡ä»¶è·¯å¾„çš„ä¸€è‡´æ€§
   - éªŒè¯æœåŠ¡æ³¨å†Œä¿¡æ¯çš„æœ‰æ•ˆæ€§
   - æ›´æ–°å…ƒæ•°æ®ç‰ˆæœ¬å·

5. **æ¢å¤åå¤„ç†**:
   - é€šçŸ¥æ‰€æœ‰èŠ‚ç‚¹é‡æ–°åŠ è½½å…ƒæ•°æ®
   - è§¦å‘è¿æ¥æ± é‡æ–°åˆå§‹åŒ–
   - è®°å½•æ¢å¤æ“ä½œæ—¥å¿—
   - é‡Šæ”¾åˆ†å¸ƒå¼é”

#### d. é«˜å¯ç”¨ä¿éšœæµç¨‹
1. **å¤šèŠ‚ç‚¹åè°ƒ**:
   - ä½¿ç”¨Redisåˆ†å¸ƒå¼é”ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œå¤‡ä»½/æ¢å¤
   - èŠ‚ç‚¹é—´é€šè¿‡Rediså‘å¸ƒ/è®¢é˜…æœºåˆ¶åŒæ­¥çŠ¶æ€
   - ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹æ‰§è¡Œç®¡ç†ä»»åŠ¡

2. **æ•…éšœæ£€æµ‹ä¸è‡ªåŠ¨æ¢å¤**:
   - å®šæœŸæ£€æŸ¥å…ƒæ•°æ®ä¸€è‡´æ€§
   - æ£€æµ‹åˆ°æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ä¿®å¤æµç¨‹
   - èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤æ—¶ï¼Œè‡ªåŠ¨åŒæ­¥æœ€æ–°å…ƒæ•°æ®
   - ç½‘ç»œåˆ†åŒºæ¢å¤åï¼Œæ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å’Œä¿®å¤

3. **æ•°æ®æ ¡éªŒä¸ä¿®å¤**:
   - å®šæœŸæ‰§è¡Œå…ƒæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
   - æ£€æŸ¥Redisä¸­çš„ç´¢å¼•ä¸MinIOå®é™…æ–‡ä»¶çš„ä¸€è‡´æ€§
   - å‘ç°ä¸ä¸€è‡´æ—¶ï¼Œè‡ªåŠ¨ä¿®å¤æˆ–ç”Ÿæˆå‘Šè­¦
   - ç»´æŠ¤è¯¦ç»†çš„æ ¡éªŒå’Œä¿®å¤æ—¥å¿—

## 5. API è®¾è®¡ (ç¤ºä¾‹)

### 5.1. RESTful API

#### 5.1.1. æ•°æ®æ“ä½œ

*   **å†™å…¥æ•°æ®**
    *   `POST /v1/data`
    *   **Body**:
        ```json
        {
          "table": "users",
          "id": "user-123",
          "timestamp": "2023-10-27T10:00:00Z",
          "payload": {
            "name": "å¼ ä¸‰",
            "age": 25,
            "city": "åŒ—äº¬"
          }
        }
        ```

*   **æŸ¥è¯¢æ•°æ®**
    *   `POST /v1/query`
    *   **Body**:
        ```json
        {
          "sql": "SELECT COUNT(*) FROM users WHERE id = 'user-123' AND timestamp >= '2023-10-01' AND payload.age > 20"
        }
        ```

*   **å¤šè¡¨æŸ¥è¯¢**
    *   `POST /v1/query`
    *   **Body**:
        ```json
        {
          "sql": "SELECT u.payload.name, COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id = o.payload.user_id GROUP BY u.payload.name"
        }
        ```

#### 5.1.2. è¡¨ç®¡ç†

*   **åˆ›å»ºè¡¨**
    *   `POST /v1/tables`
    *   **Body**:
        ```json
        {
          "table_name": "products",
          "config": {
            "buffer_size": 2000,
            "flush_interval_seconds": 60,
            "retention_days": 730,
            "backup_enabled": true
          }
        }
        ```

*   **åˆ—å‡ºè¡¨**
    *   `GET /v1/tables?pattern=user*&page=1&limit=20`
    *   **Response**:
        ```json
        {
          "tables": [
            {
              "name": "users",
              "created_at": "2024-01-15T10:00:00Z",
              "last_write": "2024-01-15T15:30:00Z",
              "status": "active",
              "record_count": 50000,
              "file_count": 25,
              "size_bytes": 1024000
            }
          ],
          "total": 1,
          "page": 1,
          "limit": 20
        }
        ```

*   **æè¿°è¡¨**
    *   `GET /v1/tables/{table_name}`
    *   **Response**:
        ```json
        {
          "table_info": {
            "name": "users",
            "config": {
              "buffer_size": 2000,
              "flush_interval_seconds": 30,
              "retention_days": 365,
              "backup_enabled": true
            },
            "created_at": "2024-01-15T10:00:00Z",
            "last_write": "2024-01-15T15:30:00Z",
            "status": "active"
          },
          "stats": {
            "record_count": 50000,
            "file_count": 25,
            "size_bytes": 1024000,
            "oldest_record": "2024-01-01T00:00:00Z",
            "newest_record": "2024-01-15T15:30:00Z"
          }
        }
        ```

*   **åˆ é™¤è¡¨**
    *   `DELETE /v1/tables/{table_name}?cascade=true`

*   **æ‰‹åŠ¨å¤‡ä»½**
    *   `POST /v1/backup/trigger`
    *   **Body**:
        ```json
        {
          "table": "users",
          "id": "user-123",
          "day": "2024-01-15"
        }
        ```

### 5.2. gRPC API

```protobuf
syntax = "proto3";

package olap.v1;

import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

service OlapService {
  // æ•°æ®æ“ä½œ
  rpc Write (WriteRequest) returns (WriteResponse);
  rpc Query (QueryRequest) returns (QueryResponse);
  
  // è¡¨ç®¡ç†
  rpc CreateTable(CreateTableRequest) returns (CreateTableResponse);
  rpc DropTable(DropTableRequest) returns (DropTableResponse);
  rpc ListTables(ListTablesRequest) returns (ListTablesResponse);
  rpc DescribeTable(DescribeTableRequest) returns (DescribeTableResponse);
  
  // å¤‡ä»½å’Œè¿ç»´
  rpc TriggerBackup(TriggerBackupRequest) returns (TriggerBackupResponse);
  rpc RecoverData(RecoverDataRequest) returns (RecoverDataResponse);
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
  rpc GetStats(GetStatsRequest) returns (GetStatsResponse);
  rpc GetNodes(GetNodesRequest) returns (GetNodesResponse);
}

// åŸºç¡€æ•°æ®æ“ä½œæ¶ˆæ¯
message WriteRequest {
  string table = 1;                    // è¡¨å
  string id = 2;                       // è®°å½•ID
  google.protobuf.Timestamp timestamp = 3;  // æ—¶é—´æˆ³
  google.protobuf.Struct payload = 4;  // æ•°æ®è½½è·
}

message WriteResponse {
  bool success = 1;
  string message = 2;
}

message QueryRequest {
  string sql = 1;  // æ”¯æŒå¤šè¡¨æŸ¥è¯¢çš„SQL
}

message QueryResponse {
  string result_json = 1;
}

// è¡¨ç®¡ç†ç›¸å…³æ¶ˆæ¯
message CreateTableRequest {
  string table_name = 1;
  TableConfig config = 2;
  bool if_not_exists = 3;
}

message CreateTableResponse {
  bool success = 1;
  string message = 2;
}

message DropTableRequest {
  string table_name = 1;
  bool if_exists = 2;
  bool cascade = 3;  // æ˜¯å¦çº§è”åˆ é™¤æ•°æ®
}

message DropTableResponse {
  bool success = 1;
  string message = 2;
  int32 files_deleted = 3;
}

message ListTablesRequest {
  string pattern = 1;  // è¡¨åæ¨¡å¼åŒ¹é…
  int32 page = 2;
  int32 limit = 3;
}

message ListTablesResponse {
  repeated TableInfo tables = 1;
  int32 total = 2;
  int32 page = 3;
  int32 limit = 4;
}

message DescribeTableRequest {
  string table_name = 1;
}

message DescribeTableResponse {
  TableInfo table_info = 1;
  TableStats stats = 2;
}

message TableInfo {
  string name = 1;
  TableConfig config = 2;
  string created_at = 3;
  string last_write = 4;
  string status = 5;  // active, archived, deleting
}

message TableConfig {
  int32 buffer_size = 1;
  int32 flush_interval_seconds = 2;
  int32 retention_days = 3;
  bool backup_enabled = 4;
  map<string, string> properties = 5;
}

message TableStats {
  int64 record_count = 1;
  int64 file_count = 2;
  int64 size_bytes = 3;
  string oldest_record = 4;
  string newest_record = 5;
}

// å¤‡ä»½å’Œè¿ç»´æ¶ˆæ¯
message TriggerBackupRequest {
  string table = 1;  // è¡¨å
  string id = 2;     // å¯é€‰ï¼Œç‰¹å®šID
  string day = 3;    // å¯é€‰ï¼Œç‰¹å®šæ—¥æœŸ format: YYYY-MM-DD
}

message TriggerBackupResponse {
  bool success = 1;
  string message = 2;
  int32 files_backed_up = 3;
}

message RecoverDataRequest {
  string table = 1;
  string backup_source = 2;  // å¤‡ä»½å­˜å‚¨ä½ç½®
  string target_date = 3;    // æ¢å¤åˆ°æŒ‡å®šæ—¥æœŸ
}

message RecoverDataResponse {
  bool success = 1;
  string message = 2;
  int32 files_recovered = 3;
}

message HealthCheckRequest {
  repeated string components = 1;  // redis, minio, nodes
}

message HealthCheckResponse {
  string overall_status = 1;  // healthy, degraded, unhealthy
  map<string, ComponentHealth> component_status = 2;
}

message ComponentHealth {
  string status = 1;
  string message = 2;
  double response_time_ms = 3;
}

message GetStatsRequest {
  string duration = 1;  // 1h, 24h, 7d
}

message GetStatsResponse {
  int64 total_queries = 1;
  int64 total_writes = 2;
  double avg_query_time_ms = 3;
  int64 total_data_size_bytes = 4;
  int32 active_tables = 5;
}

message GetNodesRequest {
  bool include_inactive = 1;
}

message GetNodesResponse {
  repeated NodeInfo nodes = 1;
  int32 total_nodes = 2;
  int32 healthy_nodes = 3;
}

message NodeInfo {
  string node_id = 1;
  string address = 2;
  string status = 3;  // healthy, unhealthy, unknown
  string last_heartbeat = 4;
  int32 active_queries = 5;
}
```
