# MinIODB éƒ¨ç½²æŒ‡å—

è¿™ä¸ªç›®å½•åŒ…å«äº†MinIODBç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆï¼Œæ”¯æŒå¤šç§ç¯å¢ƒå’Œéƒ¨ç½²æ–¹å¼ã€‚

## ğŸŒŸ éƒ¨ç½²æ–¹å¼

- [**Docker Compose**](./docker/) - å•æœºéƒ¨ç½²ï¼Œå¿«é€Ÿå¯åŠ¨ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•
- [**Kubernetes**](./k8s/) - ç”Ÿäº§çº§é›†ç¾¤éƒ¨ç½²ï¼Œæ”¯æŒé«˜å¯ç”¨å’Œæ°´å¹³æ‰©å±•
- [**Ansible**](./ansible/) - å¤šèŠ‚ç‚¹è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ”¯æŒç°æœ‰æœåŠ¡å’Œå®¹å™¨æœåŠ¡ä¸¤ç§æ¨¡å¼
- [**éƒ¨ç½²è„šæœ¬**](./scripts/) - è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç†è„šæœ¬

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

MinIODBç³»ç»Ÿç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MinIODB System                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   MinIODB   â”‚  â”‚    Redis    â”‚  â”‚    MinIO    â”‚      â”‚
â”‚  â”‚   (åº”ç”¨å±‚)   â”‚  â”‚  (å…ƒæ•°æ®å±‚)  â”‚  â”‚  (å­˜å‚¨å±‚)    â”‚      â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚      â”‚
â”‚  â”‚ gRPC: 8080  â”‚  â”‚ Port: 6379  â”‚  â”‚ API: 9000   â”‚      â”‚
â”‚  â”‚ REST: 8081  â”‚  â”‚             â”‚  â”‚ Console:9001â”‚      â”‚
â”‚  â”‚ Metrics:9090â”‚  â”‚             â”‚  â”‚             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Network Layer                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš€ éƒ¨ç½²æ–¹å¼å¯¹æ¯”

| ç‰¹æ€§ | Docker Compose | Ansible | Kubernetes | 
|------|----------------|------------|---------|
| **é€‚ç”¨åœºæ™¯** | å¼€å‘/æµ‹è¯• | å¤šèŠ‚ç‚¹ç”Ÿäº§ | ç”Ÿäº§é›†ç¾¤ | 
| **å¤æ‚åº¦** | ç®€å• |  ä¸­ç­‰ | å¤æ‚ |
| **æ‰©å±•æ€§** | æœ‰é™ |  è‰¯å¥½ | ä¼˜ç§€ |
| **é«˜å¯ç”¨** | å¦ |  æ˜¯ | æ˜¯ |
| **è‡ªåŠ¨åŒ–** | åŸºç¡€ |  é«˜çº§ | é«˜çº§ |
| **å­¦ä¹ æˆæœ¬** | ä½ |  ä¸­ç­‰ | é«˜ |
| **è¿ç»´éš¾åº¦** | ä½ |  ä¸­ç­‰ | é«˜ |
| **èŠ‚ç‚¹æ•°é‡** | å•èŠ‚ç‚¹ | å¤šèŠ‚ç‚¹ | å¤šèŠ‚ç‚¹ |
| **æœåŠ¡å‘ç°** | å†…ç½® |  æ‰‹åŠ¨é…ç½® | å†…ç½® |

### ç»„ä»¶è¯´æ˜

- **MinIODB**: æ ¸å¿ƒåº”ç”¨æœåŠ¡ï¼Œæä¾›gRPCå’ŒREST API
- **Redis**: å…ƒæ•°æ®ä¸­å¿ƒï¼Œè´Ÿè´£æœåŠ¡å‘ç°ã€æ•°æ®ç´¢å¼•å’Œä¸€è‡´æ€§å“ˆå¸Œ
- **MinIO**: å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼Œæä¾›S3å…¼å®¹çš„åˆ†å¸ƒå¼å­˜å‚¨
- **MinIO-Backup**: å¤‡ä»½å­˜å‚¨å®ä¾‹ï¼Œç”¨äºæ•°æ®å¤‡ä»½å’Œæ¢å¤

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å•æœºéƒ¨ç½² (æ¨è)

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd minIODB/deploy/docker

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„é…ç½®

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. éªŒè¯éƒ¨ç½²
./scripts/health-check.sh
```

### Ansibleå¤šèŠ‚ç‚¹éƒ¨ç½²

```bash
# 1. å®‰è£…Ansible
pip3 install ansible docker

# 2. é…ç½®æ¸…å•æ–‡ä»¶
cd deploy/ansible
cp inventory/auto-deploy.yml.example inventory/auto-deploy.yml
# ç¼–è¾‘æ¸…å•æ–‡ä»¶ï¼Œè®¾ç½®ä¸»æœºIPå’ŒæœåŠ¡åˆ†é…

# 3. é…ç½®è®¤è¯ä¿¡æ¯
ansible-vault create group_vars/all/vault.yml
# è®¾ç½®Redisã€MinIOç­‰æœåŠ¡çš„å¯†ç 

# 4. æ‰§è¡Œéƒ¨ç½²
./scripts/deploy-ansible.sh auto

# 5. éªŒè¯éƒ¨ç½²
ansible -i inventory/auto-deploy.yml all -m shell -a "docker ps"
```

### Kuberneteséƒ¨ç½²

```bash
# 1. åˆ›å»ºå‘½åç©ºé—´å’ŒåŸºç¡€èµ„æº
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/configmap.yaml
kubectl apply -f k8s/secret.yaml

# 2. éƒ¨ç½²å­˜å‚¨æœåŠ¡
kubectl apply -f k8s/redis/
kubectl apply -f k8s/minio/

# 3. éƒ¨ç½²åº”ç”¨æœåŠ¡
kubectl apply -f k8s/miniodb/

# 4. éªŒè¯éƒ¨ç½²
kubectl get pods -n miniodb-system
```

## ğŸ“‹ éƒ¨ç½²è¦æ±‚

### ç¡¬ä»¶è¦æ±‚

| ç¯å¢ƒ | CPU | å†…å­˜ | å­˜å‚¨ | ç½‘ç»œ |
|------|-----|------|------|------|
| å¼€å‘ç¯å¢ƒ | 2æ ¸ | 4GB | 20GB | 1Gbps |
| æµ‹è¯•ç¯å¢ƒ | 4æ ¸ | 8GB | 100GB | 1Gbps |
| ç”Ÿäº§ç¯å¢ƒ | 8æ ¸+ | 16GB+ | 500GB+ | 10Gbps |

### è½¯ä»¶è¦æ±‚

#### Docker Composeéƒ¨ç½²
- Docker 20.10+
- Docker Compose 2.0+
- å¯ç”¨ç«¯å£ï¼š6379, 8080, 8081, 9000, 9001, 9002, 9003, 9090

#### Kuberneteséƒ¨ç½²
- Kubernetes 1.20+
- kubectl é…ç½®å®Œæˆ
- å­˜å‚¨ç±»æ”¯æŒåŠ¨æ€åˆ†é…
- è´Ÿè½½å‡è¡¡å™¨æ”¯æŒ (ç”Ÿäº§ç¯å¢ƒ)

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `MINIODB_ENV` | `production` | è¿è¡Œç¯å¢ƒ |
| `MINIODB_LOG_LEVEL` | `info` | æ—¥å¿—çº§åˆ« |
| `MINIO_ROOT_USER` | `minioadmin` | MinIOç®¡ç†å‘˜ç”¨æˆ·å |
| `MINIO_ROOT_PASSWORD` | `minioadmin123` | MinIOç®¡ç†å‘˜å¯†ç  |
| `REDIS_PASSWORD` | `redis123` | Rediså¯†ç  |

### ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | åè®® | è¯´æ˜ |
|------|------|------|------|
| MinIODB gRPC | 8080 | TCP | gRPC APIæœåŠ¡ |
| MinIODB REST | 8081 | HTTP | REST APIæœåŠ¡ |
| MinIODB Metrics | 9090 | HTTP | Prometheusç›‘æ§ |
| Redis | 6379 | TCP | Redisæ•°æ®åº“ |
| MinIO API | 9000 | HTTP | S3 APIæœåŠ¡ |
| MinIO Console | 9001 | HTTP | ç®¡ç†ç•Œé¢ |
| MinIO Backup API | 9002 | HTTP | å¤‡ä»½S3 API |
| MinIO Backup Console | 9003 | HTTP | å¤‡ä»½ç®¡ç†ç•Œé¢ |

## ğŸ”§ è¿ç»´ç®¡ç†

### å¥åº·æ£€æŸ¥

```bash
# Dockerç¯å¢ƒ
docker-compose ps
curl http://localhost:8081/v1/health

# Kubernetesç¯å¢ƒ  
kubectl get pods -n miniodb-system
kubectl logs -f deployment/miniodb -n miniodb-system
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# Dockerç¯å¢ƒ
docker-compose logs -f miniodb
docker-compose logs -f redis
docker-compose logs -f minio

# Kubernetesç¯å¢ƒ
kubectl logs -f deployment/miniodb -n miniodb-system
kubectl logs -f statefulset/redis -n miniodb-system
kubectl logs -f statefulset/minio -n miniodb-system
```

### æ•°æ®å¤‡ä»½

```bash
# æ‰‹åŠ¨å¤‡ä»½
curl -X POST http://localhost:8081/v1/backup/trigger \
  -H "Content-Type: application/json" \
  -d '{"id": "user123", "day": "2024-01-15"}'

# å®šæ—¶å¤‡ä»½ (å»ºè®®ä½¿ç”¨cron job)
0 2 * * * /path/to/backup-script.sh
```

### æ‰©å®¹æ“ä½œ

```bash
# Dockerç¯å¢ƒ (å‚ç›´æ‰©å®¹)
docker-compose up -d --scale miniodb=3

# Kubernetesç¯å¢ƒ (æ°´å¹³æ‰©å®¹)
kubectl scale deployment miniodb --replicas=3 -n miniodb-system
```

## ğŸ”’ å®‰å…¨é…ç½®

### è®¤è¯é…ç½®

1. **JWTè®¤è¯**: åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®JWTå¯†é’¥
2. **MinIOè®¤è¯**: ä½¿ç”¨å¼ºå¯†ç å’Œè®¿é—®å¯†é’¥
3. **Redisè®¤è¯**: å¯ç”¨å¯†ç è®¤è¯
4. **ç½‘ç»œå®‰å…¨**: é…ç½®é˜²ç«å¢™è§„åˆ™

### TLSé…ç½®

```bash
# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ (å¼€å‘ç¯å¢ƒ)
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout tls.key -out tls.crt

# ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨CAç­¾å‘çš„è¯ä¹¦
```

## ğŸ“Š ç›‘æ§å‘Šè­¦

### Prometheusç›‘æ§

MinIODBå†…ç½®Prometheus metricsæ”¯æŒï¼š

- åº”ç”¨æ€§èƒ½æŒ‡æ ‡
- ç³»ç»Ÿèµ„æºæŒ‡æ ‡  
- ä¸šåŠ¡æ“ä½œæŒ‡æ ‡

### ç›‘æ§é¢æ¿

æ¨èä½¿ç”¨Grafanaåˆ›å»ºç›‘æ§é¢æ¿ï¼š

- ç³»ç»Ÿæ¦‚è§ˆé¢æ¿
- æ€§èƒ½åˆ†æé¢æ¿
- é”™è¯¯ç‡ç›‘æ§é¢æ¿

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡æ— æ³•å¯åŠ¨**
   - æ£€æŸ¥ç«¯å£å ç”¨: `netstat -tlnp | grep :8080`
   - æ£€æŸ¥ç£ç›˜ç©ºé—´: `df -h`
   - æŸ¥çœ‹æœåŠ¡æ—¥å¿—: `docker-compose logs miniodb`

2. **è¿æ¥è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥: `telnet localhost 8080`
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - éªŒè¯æœåŠ¡å¥åº·çŠ¶æ€

3. **æ•°æ®ä¸ä¸€è‡´**
   - æ£€æŸ¥Redisè¿æ¥çŠ¶æ€
   - éªŒè¯MinIOå­˜å‚¨çŠ¶æ€
   - æ‰§è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

### æ€§èƒ½ä¼˜åŒ–

1. **å­˜å‚¨ä¼˜åŒ–**
   - ä½¿ç”¨SSDå­˜å‚¨
   - é…ç½®åˆé€‚çš„ç¼“å†²åŒºå¤§å°
   - å¯ç”¨æ•°æ®å‹ç¼©

2. **ç½‘ç»œä¼˜åŒ–**
   - ä½¿ç”¨é«˜é€Ÿç½‘ç»œ
   - é…ç½®è¿æ¥æ± 
   - å¯ç”¨Keep-Alive

3. **å†…å­˜ä¼˜åŒ–**
   - è°ƒæ•´JVMå‚æ•°
   - é…ç½®Rediså†…å­˜é™åˆ¶
   - ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Dockeréƒ¨ç½²è¯¦ç»†è¯´æ˜](./docker/README.md)
- [Kuberneteséƒ¨ç½²è¯¦ç»†è¯´æ˜](./k8s/README.md)
- [éƒ¨ç½²è„šæœ¬ä½¿ç”¨è¯´æ˜](./scripts/README.md)
- [APIä½¿ç”¨ç¤ºä¾‹](../examples/README.md)
- [ç³»ç»Ÿé…ç½®è¯´æ˜](../config.yaml)

## ğŸ¤ æ”¯æŒä¸åé¦ˆ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ç›¸å…³æ–‡æ¡£å’ŒFAQ
2. æ£€æŸ¥ç³»ç»Ÿæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
3. æäº¤Issueæˆ–è”ç³»æŠ€æœ¯æ”¯æŒ

---

**æ³¨æ„**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ï¼Œè¯·ä»”ç»†é˜…è¯»å®‰å…¨é…ç½®ç« èŠ‚ï¼Œç¡®ä¿ç³»ç»Ÿå®‰å…¨æ€§ã€‚ 