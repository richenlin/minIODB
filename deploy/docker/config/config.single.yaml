server:
  grpc_port: ":8080"
  rest_port: ":8081"
  node_id: "miniodb-single-node"

# 单节点模式：禁用Redis
redis:
  enabled: false

# MinIO配置
minio:
  endpoint: "minio:9000"
  access_key_id: "minioadmin"
  secret_access_key: "minioadmin"
  use_ssl: false
  region: "us-east-1"
  bucket: "miniodb-data"

# 网络和连接池配置
network:
  server:
    grpc:
      max_connections: 500
      connection_timeout: 30s
      stream_timeout: 60s
      keep_alive_time: 30s
      keep_alive_timeout: 5s
      max_connection_idle: 15m
      max_connection_age: 30m
      max_connection_age_grace: 5s
      max_send_msg_size: 4194304
      max_recv_msg_size: 4194304
    
    rest:
      read_timeout: 30s
      write_timeout: 30s
      idle_timeout: 60s
      read_header_timeout: 10s
      max_header_bytes: 1048576
      shutdown_timeout: 30s
  
  pools:
    minio:
      endpoint: "minio:9000"
      access_key_id: "minioadmin"
      secret_access_key: "minioadmin"
      use_ssl: false
      region: "us-east-1"
      bucket: "miniodb-data"
      
      max_idle_conns: 100
      max_idle_conns_per_host: 50
      max_conns_per_host: 100
      idle_conn_timeout: 90s
      dial_timeout: 5s
      tls_handshake_timeout: 5s
      response_header_timeout: 15s
      expect_continue_timeout: 1s
      max_retries: 3
      retry_delay: 100ms
      request_timeout: 60s
      keep_alive: 30s
      disable_keep_alive: false
      disable_compression: false
    
    health_check_interval: 15s

# 智能限流系统
rate_limiting:
  enabled: true
  
  tiers:
    health:
      requests_per_second: 200
      burst_size: 50
      window_size: "1s"
    query:
      requests_per_second: 100
      burst_size: 30
      window_size: "1s"
    write:
      requests_per_second: 80
      burst_size: 20
      window_size: "1s"
    standard:
      requests_per_second: 50
      burst_size: 15
      window_size: "1s"
    strict:
      requests_per_second: 20
      burst_size: 5
      window_size: "1s"
  
  path_rules:
    - path: "/health"
      method: "GET"
      tier: "health"
    - path: "/v1/health"
      method: "GET"
      tier: "health"
    - path: "/metrics"
      method: "GET"
      tier: "health"
    - path: "/v1/query"
      method: "POST"
      tier: "query"
    - path: "/v1/data"
      method: "POST"
      tier: "write"
  
  default_tier: "standard"
  
  response:
    include_tier: true
    include_limit: true
    include_burst: true
    include_window: true
    include_retry_after: true

# 查询性能优化（单节点模式简化配置）
query_optimization:
  file_cache:
    enabled: true
    cache_dir: "/tmp/miniodb_cache"
    max_cache_size: 524288000
    max_file_age: 7200s
    cleanup_interval: 600s
    enable_stats: true
    stats_interval: 60s
  
  duckdb:
    enabled: true
    pool_size: 3
    max_idle_time: 1800s
    connection_timeout: 30s
    
    performance:
      memory_limit: "512MB"
      threads: 2
      enable_object_cache: true
      temp_directory: "/tmp/duckdb"

# 缓冲区优化配置
buffer:
  buffer_size: 1000
  flush_interval: 30s
  worker_pool_size: 4
  task_queue_size: 50
  batch_flush_size: 5
  enable_batching: true
  flush_timeout: 60s
  max_retries: 3
  retry_delay: 1s
  enable_concurrent: true
  enable_metrics: true

# 备份配置（单节点模式可选）
backup:
  enabled: false

# 日志配置
log:
  level: "info"
  format: "json"
  output: "both"
  filename: "logs/minIODB.log"
  max_size: 100
  max_backups: 5
  max_age: 30
  compress: true

# 监控配置
monitoring:
  enabled: true
  port: ":8082"
  path: "/metrics"
  prometheus: true

# 认证配置
auth:
  enable_jwt: true
  jwt_secret: "your-super-secret-jwt-key-change-this-in-production"
  token_expiry: "24h"
  enable_api_key: true
  api_keys:
    - "api-key-1234567890abcdef"
    - "api-key-0987654321fedcba"
  skip_auth_paths:
    - "/health"
    - "/metrics"
    - "/v1/health"
  require_auth_paths:
    - "/v1/data"
    - "/v1/query"
    - "/v1/tables"

# 表管理配置
table_management:
  auto_create_tables: true
  default_table: "default"
  max_tables: 100
  table_name_pattern: "^[a-zA-Z][a-zA-Z0-9_]{0,63}$"
  
  default_config:
    buffer_size: 1000
    flush_interval_seconds: 30
    retention_days: 365
    backup_enabled: false
    properties: {}
  
  tables: {}

# 存储引擎优化配置
storage_engine:
  enabled: true
  auto_optimization: true
  optimize_interval: 3600s
  performance_mode: "balanced"
  enable_monitoring: true
  enable_profiling: false
  
  parquet:
    default_compression: "zstd"
    default_partition: "analytical"
    auto_select_strategy: true
    compression_analysis: true
    metadata_indexing: true
  
  sharding:
    default_strategy: "hash_uniform"
    auto_rebalance: false
    hot_cold_separation: false
  
  indexing:
    auto_index_creation: true
    index_types: ["bloom", "minmax"]
    bloom_filter_enabled: true
    minmax_enabled: true
  
  memory:
    enable_pooling: true
    enable_zero_copy: true
    buffer_optimization: true
    gc_optimization: true
    max_memory_usage: 1073741824

# 安全配置
security:
  mode: "jwt"
  jwt_secret: "your-super-secret-jwt-key-change-this-in-production"
  enable_tls: false
  valid_tokens: 
    - "test-token-123456"
    - "admin-token-abcdef"
  
  smart_rate_limit:
    enabled: true
    default_tier: "standard"
    cleanup_interval: "5m"

